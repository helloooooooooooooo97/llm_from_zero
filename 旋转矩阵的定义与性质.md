
我们首先定义用于二维向量的旋转矩阵 $R_i$ 并证明其关键代数性质。

# 旋转矩阵的定义

在 RoPE 中，我们需要在二维平面上对向量进行旋转操作。让我们从几何和代数的角度推导旋转矩阵的形式。

考虑二维平面上的一个单位向量 $\mathbf{e}_1 = \begin{pmatrix} 1 \\ 0 \end{pmatrix}$（沿 $x$ 轴的单位向量）。将其逆时针旋转角度 $\alpha$ 后，得到新向量：

$$\mathbf{e}_1' = \begin{pmatrix} \cos \alpha \\ \sin \alpha \end{pmatrix}$$

类似地，将单位向量 $\mathbf{e}_2 = \begin{pmatrix} 0 \\ 1 \end{pmatrix}$（沿 $y$ 轴的单位向量）旋转角度 $\alpha$ 后，得到：

$$\mathbf{e}_2' = \begin{pmatrix} -\sin \alpha \\ \cos \alpha \end{pmatrix}$$

这是因为 $\mathbf{e}_2$ 旋转 $\alpha$ 后，其 $x$ 分量为 $-\sin \alpha$（负号来自顺时针方向），$y$ 分量为 $\cos \alpha$。

#### 线性变换的矩阵表示

旋转是一个线性变换，因此可以用矩阵表示。旋转矩阵的列向量就是标准基向量旋转后的结果。因此，旋转角度 $\alpha$ 的旋转矩阵为：

$$R(\alpha) = \begin{pmatrix} \cos \alpha & -\sin \alpha \\ \sin \alpha & \cos \alpha \end{pmatrix}$$

其中：
- 第一列是 $\mathbf{e}_1$ 旋转后的结果：$\begin{pmatrix} \cos \alpha \\ \sin \alpha \end{pmatrix}$
- 第二列是 $\mathbf{e}_2$ 旋转后的结果：$\begin{pmatrix} -\sin \alpha \\ \cos \alpha \end{pmatrix}$

# 旋转矩阵的证明

现在我们从几何角度严格证明：旋转矩阵 $R(\theta)$ 作用于向量确实对应着在二维平面中的旋转操作。

考虑一个二维向量 $\mathbf{v} = \begin{pmatrix} x \\ y \end{pmatrix}$，其长度为 $r = \sqrt{x^2 + y^2}$，与原点的夹角为 $\theta_0$，即：

$$x = r \cos\theta_0, \quad y = r \sin\theta_0$$

二维旋转矩阵（绕原点逆时针转 $\theta$ 角）为：

$$R(\theta) = \begin{pmatrix} \cos\theta & -\sin\theta \\ \sin\theta & \cos\theta \end{pmatrix}$$

用它左乘 $\mathbf{v}$ 得：

$$\mathbf{v}' = R(\theta) \mathbf{v} = \begin{pmatrix} \cos\theta \cdot x - \sin\theta \cdot y \\ \sin\theta \cdot x + \cos\theta \cdot y \end{pmatrix}$$

将 $x = r\cos\theta_0$、$y = r\sin\theta_0$ 代入，得：

$$\begin{aligned}
\mathbf{v}' &= \begin{pmatrix}
r\cos\theta \cos\theta_0 - r\sin\theta \sin\theta_0 \\
r\sin\theta \cos\theta_0 + r\cos\theta \sin\theta_0
\end{pmatrix} \\
&= \begin{pmatrix}
r\cos(\theta + \theta_0) \\
r\sin(\theta + \theta_0)
\end{pmatrix}
\end{aligned}$$

这里使用了三角函数的和角公式：

$$\cos(\theta+\theta_0) = \cos\theta\cos\theta_0 - \sin\theta\sin\theta_0$$

$$\sin(\theta+\theta_0) = \sin\theta\cos\theta_0 + \cos\theta\sin\theta_0$$

因此，新的向量坐标为：

$$\mathbf{v}' = \begin{pmatrix} r\cos(\theta+\theta_0) \\ r\sin(\theta+\theta_0) \end{pmatrix}$$

其长度仍为 $r$，而角度变为 $\theta_0 + \theta$，说明向量在二维平面中绕原点逆时针旋转了 $\theta$ 角。

**从线性代数角度的补充说明：**

旋转矩阵是正交矩阵（$R^T R = I$）且行列式 $\det R = 1$，这表明它：
- 保持向量长度不变（正交性）
- 保持向量间的夹角不变（等距变换）
- 保持定向（行列式为 1，不含镜像）

在二维中，满足这些性质的等距变换只能是旋转（不含镜像）。

综上，用几何坐标代入与用矩阵性质分析都可证明：二维旋转矩阵作用于向量确实对应着旋转操作。

# 旋转矩阵的性质

基于上述推导，对于位置 $i$ 和预设的频率参数 $\theta$，我们将 $Q/K$ 向量的每一对维度视为一个二维子空间，其上的旋转矩阵 $R_i$ 定义为：

$$R_i = R(i \cdot \theta) = \begin{pmatrix} \cos(i \cdot \theta) & -\sin(i \cdot \theta) \\ \sin(i \cdot \theta) & \cos(i \cdot \theta) \end{pmatrix}$$

这个矩阵将向量在二维平面上旋转 $i \cdot \theta$ 角度，其中 $i$ 是位置索引，$\theta$ 是预设的频率参数。


## 性质 1：正交性与逆矩阵

旋转矩阵是正交矩阵，满足 $R_i^T R_i = I$ (单位矩阵)。因此，其转置即为逆矩阵：$R_i^T = R_i^{-1}$。

**证明：**
$$R_i^T R_i = \begin{pmatrix} \cos(i \cdot \theta) & \sin(i \cdot \theta) \\ -\sin(i \cdot \theta) & \cos(i \cdot \theta) \end{pmatrix} \begin{pmatrix} \cos(i \cdot \theta) & -\sin(i \cdot \theta) \\ \sin(i \cdot \theta) & \cos(i \cdot \theta) \end{pmatrix}$$

应用 $\cos^2 x + \sin^2 x = 1$ 和三角函数的奇偶性，展开计算结果为：
$$R_i^T R_i = \begin{pmatrix} 1 & 0 \\ 0 & 1 \end{pmatrix} = I$$

## 性质 2：旋转角度的复合（加性特性）

两个旋转矩阵的乘积对应于角度的叠加：
$$R(\theta_1) R(\theta_2) = R(\theta_1 + \theta_2)$$

**证明：**
通过矩阵乘法并利用三角函数的**角和公式** ($\cos(\theta_1 + \theta_2)$ 和 $\sin(\theta_1 + \theta_2)$) 即可严格证明。