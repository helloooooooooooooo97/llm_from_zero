# 表达相对位置关系

经典正弦位置编码的核心公式如下：

$$
PE_{(pos, 2i)} = \sin(pos / 10000^{2i/d_{model}}) \\
PE_{(pos, 2i+1)} = \cos(pos / 10000^{2i/d_{model}})
$$

其巧妙之处在于，不同位置编码的点积可以表示为它们相对距离的函数。具体而言，对于某个固定偏移 $k$，位置 $pos + k$ 的编码与 $pos$ 的编码之间满足一个线性映射（可看作旋转变换）。这意味着在自注意力中，$Q_i \cdot K_j$ 不仅携带了绝对位置信息，也能让模型通过训练主动捕捉 $i-j$ 这种相对关系，特别是在注意力学习过程中。

**满足程度：** ✅ 部分满足。虽然正弦PE为模型捕捉相对关系提供了良好结构，但并不直接编码相对位置信息，需要模型自主挖掘和利用周期结构。

# 平移不变性与周期性

- **平移不变性：** 绝对位置编码并不具备严格的平移不变性。每一个位置都有唯一编码，一旦在句首插入新词，后续token的编码会随之全变。这是绝对位置编码的主要短板之一。
- **周期性：** 正弦PE的最大优势正体现在周期性。三角函数的周期性让编码在空间上呈现出丰富的周期变化，不同频率的正余弦波叠加，可自然描述重复、循环、对称等模式，有助于模型捕捉序列中的周期性结构（如韵律、实体重复、分句界限等）。

**满足程度：**
- 平移不变性：❌ 不满足
- 周期性：✅ 完美满足

# 值域有界、尺度合理

正弦与余弦函数本身值域恒定在 $[-1, 1]$，确保每一维的位置编码不会出现过大或过小的数值漂移。这样的范围与标准初始化的词向量尺度相似。当位置编码和词向量相加时，不会对原始语义空间产生数值冲击，实现良好的兼容性。

**满足程度：** ✅ 完美满足

# 可泛化到任意长度

函数式绝对位置编码的一大优势就在于**外推性**。所有位置编码均由显式数学函数生成，不依赖训练时出现的最大序列长度。推理（测试）阶段，遇到任意长度的输入，都可通过公式即时计算该位置的编码，实现理论上的无限外推。

**满足程度：** ✅ 完美满足

# 唯一性

正弦位置编码由多个不同频率的三角波叠加，只要 $d_{model}$ 足够大，绝大多数情况下不同位置的编码均不同。这让模型可以有效地区分“第1个”和“第1000个”token，避免位置混淆，是位置编码的基本要求之一。

**满足程度：** ✅ 完美满足

# 总结与对比

经典正弦绝对位置编码在周期性、值域、外推性和唯一性方面表现卓越。其主要弱点在于缺乏平移不变性，对相对位置关系的表达也较为间接、需模型自行学习和抽象。这也正是后续相对位置编码（如 T5 的 Bias、RoPE、ALiBi 等）方案不断创新的动因——它们在兼顾长序列外推等优点基础上，进一步追求对相对位置信息的直接、鲁棒建模，以及更高程度的平移不变性。
| 特性         | 正弦绝对位置编码的表现        | 说明                                              |
|--------------|--------------------------|---------------------------------------------------|
| 表达相对位置 | ✅ 部分/结构性满足           | 提供利于学习相对关系的结构，但不是直接编码         |
| 平移不变性   | ❌ 不满足                   | 绝对位置决定全部信息，插入文本会改变后续全部编码   |
| 周期性       | ✅ 完美满足                 | 三角函数的原生周期性，非常适合捕捉循环/模板结构   |
| 值域有界     | ✅ 完美满足                 | 匹配词向量尺度，数值存在安全区间                  |
| 长度外推     | ✅ 完美满足                 | 由公式定义，不受训练时序列长度限制                 |
| 唯一性       | ✅ 完美满足                 | 编码向量唯一，避免位置歧义                         |

